(function(){"use strict";var t={1751:function(t,e,s){var n=s(9242),i=s(3396),a=s(7139),r=s(7718),l=s(702),o=s(4075),u=s(1539),d=s(3289),c=s(6613),h=s(9457),g=s(3140),m=s(5848);const p={key:0,class:"login-box"},w=(0,i._)("h1",null,"欢迎来到小狼窝",-1),f=(0,i._)("img",{src:"http://qiming.hust.edu.cn/__local/A/A6/8E/98BB6679033FA4134BF39F840D7_0043A688_4077.jpg",alt:"avatar",class:"avatar"},null,-1),k=(0,i._)("div",null,null,-1),D=(0,i._)("h2",null,"负责人",-1),T={class:"MyCard"},y=["onClick"],_=(0,i._)("h2",null,"当前占用",-1),U={key:0},v={key:1},I=(0,i._)("h2",null,"任务",-1),C={class:"MyCard"},b=(0,i._)("td",{class:"font-weight-bold"},"任务名",-1),W=(0,i._)("td",{class:"font-weight-bold"},"简述",-1),x=(0,i._)("td",{class:"font-weight-bold"},"开始时间",-1),A=(0,i._)("td",{class:"font-weight-bold"},"预期时间",-1),S=(0,i._)("td",{class:"font-weight-bold"},"完成进度",-1),O=(0,i._)("td",{class:"font-weight-bold"},"时间进度",-1),B=(0,i._)("td",{class:"font-weight-bold"},"查看详情",-1),G=["onClick"],E=["onClick"],N=["onClick"],z=["onClick"],P=["onClick"],V=(0,i._)("h3",null,"负责人",-1),j={class:"MyCard"},M=["onClick"],J=(0,i._)("h3",null,"文档",-1);function L(t,e,s,n,L,R){const Z=(0,i.up)("SidebarDisplay"),q=(0,i.up)("alert-box"),F=(0,i.up)("InputBox"),H=(0,i.up)("StatusDisplay"),$=(0,i.up)("TaskDisplay"),Y=(0,i.up)("v-md-editor"),K=(0,i.up)("v-md-preview");return(0,i.wg)(),(0,i.j4)(r.q,null,{default:(0,i.w5)((()=>[L.loggedIn?((0,i.wg)(),(0,i.j4)(Z,{key:0,unitGroups:L.unitGroup,loggedIn:L.loggedIn,avatar:L.avatar,currentUser:L.currentUser,onSelectTask:R.selectUnitGroup,title:L.currentTitle},null,8,["unitGroups","loggedIn","avatar","currentUser","onSelectTask","title"])):(0,i.kq)("",!0),(0,i.Wm)(q,{"show-dialog":L.showDialog,"onUpdate:showDialog":e[0]||(e[0]=t=>L.showDialog=t),message:L.alertMessage},null,8,["show-dialog","message"]),(0,i.Wm)(F,{modelValue:L.showInputBox,"onUpdate:modelValue":e[1]||(e[1]=t=>L.showInputBox=t),message:L.alertMessage,onUserInput:L.userInputSubmitted},null,8,["modelValue","message","onUserInput"]),(0,i.Wm)(g.O,null,{default:(0,i.w5)((()=>[(0,i.Wm)(u.K,null,{default:(0,i.w5)((()=>[L.loggedIn?L.loggedIn&&"UnitGroups"===L.currentPage?((0,i.wg)(),(0,i.j4)(c.i,{key:1},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(t.taskGroups,(t=>((0,i.wg)(),(0,i.j4)(h.l,{key:t.id},{default:(0,i.w5)((()=>[(0,i._)("h1",null,(0,a.zw)(t.name),1),(0,i._)("div",null,(0,a.zw)(t.progress),1),(0,i.Wm)(H,{task:t},null,8,["task"]),(0,i.Wm)(o.J,{class:"custom-divider"})])),_:2},1024)))),128))])),_:1})):L.loggedIn&&"UnitGroupDetail"===L.currentPage?((0,i.wg)(),(0,i.j4)(c.i,{key:2},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(L.currentUnitGroup.unitsList,(t=>((0,i.wg)(),(0,i.iD)("div",{key:t.ID},[(0,i._)("h1",null,(0,a.zw)(R.getUnit(t)?.DisplayName??"加载中"),1),D,(0,i._)("div",T,[(0,i.Wm)(l.T,{onClick:e=>R.throwInputBox("添加单位负责人",t,R.addUnitUserInCharge),color:"primary",class:"float-right"},{default:(0,i.w5)((()=>[(0,i.Wm)(d.t,null,{default:(0,i.w5)((()=>[(0,i.Uk)("mdi-plus-box")])),_:1})])),_:2},1032,["onClick"]),(0,i._)("table",null,[(0,i._)("tbody",null,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(R.getUnit(t)?.InChargeUsers,(e=>((0,i.wg)(),(0,i.iD)("tr",{key:e.ID},[(0,i._)("td",null,(0,a.zw)(R.getUser(e)?.DisplayName),1),(0,i._)("td",null,(0,a.zw)(L.techGroup[R.getUser(e)?.TechGroup[0]].name),1),(0,i._)("td",{onClick:s=>R.deleteUnitUserInCharge(e,t)},[(0,i.Wm)(l.T,null,{default:(0,i.w5)((()=>[(0,i.Wm)(d.t,null,{default:(0,i.w5)((()=>[(0,i.Uk)("mdi-account-multiple-remove-outline")])),_:1})])),_:1})],8,y)])))),128))])])]),_,-1===R.getUnit(t)?.CurrentUserID?((0,i.wg)(),(0,i.iD)("div",U,"无")):((0,i.wg)(),(0,i.iD)("div",v,(0,a.zw)(R.getUser(R.getUnit(t)?.CurrentUserID)?.DisplayName),1)),(0,i.Wm)(o.J,{class:"custom-divider"}),I,(0,i._)("div",C,[(0,i.Wm)(l.T,{onClick:e=>R.addTask(t),color:"primary",class:"float-right"},{default:(0,i.w5)((()=>[(0,i.Wm)(d.t,null,{default:(0,i.w5)((()=>[(0,i.Uk)("mdi-plus-box")])),_:1})])),_:2},1032,["onClick"]),(0,i._)("table",null,[(0,i._)("tbody",null,[b,W,x,A,S,O,B,((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(R.getUnit(t)?.InProgressTasks,(t=>((0,i.wg)(),(0,i.iD)("tr",{key:t},[(0,i._)("td",{onClick:e=>R.throwInputBox("修改任务名称",R.getTask(t),R.updateTaskName)},(0,a.zw)(R.getTask(t)?.Name),9,G),(0,i._)("td",{onClick:e=>R.throwInputBox("修改任务简述",R.getTask(t),R.updateTaskDescription)},(0,a.zw)(R.getTask(t)?.Description),9,E),(0,i._)("td",{onClick:e=>R.throwInputBox("修改任务开始时间（2023-08-26 22:43:00）",R.getTask(t),R.updateTaskStartTime)},(0,a.zw)(R.getTask(t)?.StartTime),9,N),(0,i._)("td",{onClick:e=>R.throwInputBox("修改任务预期时间（2023-08-26 22:43:00）",R.getTask(t),R.updateTaskDeadLine)},(0,a.zw)(R.getTask(t)?.DeadLine),9,z),(0,i._)("td",{onClick:e=>R.throwInputBox("格式为0.3",R.getTask(t),R.updateTaskProgress)},(0,a.zw)((100*R.getTask(t)?.Progress).toFixed(0))+"%",9,P),(0,i._)("td",null,(0,a.zw)(((Date.now()-R.stringToTime(R.getTask(t)?.StartTime))/(R.stringToTime(R.getTask(t).DeadLine)-R.stringToTime(R.getTask(t)?.StartTime))*100).toFixed(2))+"%",1),(0,i._)("td",null,[(0,i.Wm)(l.T,{onClick:e=>R.selectTask(t)},{default:(0,i.w5)((()=>[(0,i.Wm)(d.t,null,{default:(0,i.w5)((()=>[(0,i.Uk)("mdi-arrow-right")])),_:1})])),_:2},1032,["onClick"])])])))),128))])])]),(0,i.Wm)(o.J,{class:"custom-divider"})])))),128)),(0,i._)("h2",null,[(0,i.Wm)(d.t,null,{default:(0,i.w5)((()=>[(0,i.Uk)("mdi-check-all")])),_:1}),(0,i.Uk)(" 任务")]),(0,i.Wm)($,{users:L.users,tasks:L.unitGroup[L.selectedUnitGroup].tasks},null,8,["users","tasks"]),(0,i.Wm)(o.J,{class:"custom-divider"}),(0,i._)("h2",null,[(0,i.Wm)(d.t,null,{default:(0,i.w5)((()=>[(0,i.Uk)("mdi-comment-account-outline")])),_:1}),(0,i.Uk)(" 留言")])])),_:1})):L.loggedIn&&"TaskDetail"===L.currentPage?((0,i.wg)(),(0,i.iD)(i.HY,{key:3},[(0,i.Wm)(l.T,{onClick:e[5]||(e[5]=t=>R.selectUnitGroup(L.selectedUnitGroup)),color:"primary",class:"float-right"},{default:(0,i.w5)((()=>[(0,i.Wm)(d.t,null,{default:(0,i.w5)((()=>[(0,i.Uk)("mdi-arrow-left")])),_:1})])),_:1}),(0,i._)("h1",null,(0,a.zw)(R.getUnit(R.getTask(L.selectedTask).BindUnitID).DisplayName),1),(0,i.Wm)(o.J,{class:"custom-divider"}),(0,i._)("h2",null,(0,a.zw)(R.getTask(L.selectedTask).Name),1),(0,i.Uk)(" "+(0,a.zw)(R.getTask(L.selectedTask).Description)+" ",1),V,(0,i._)("div",j,[(0,i.Wm)(l.T,{onClick:e[6]||(e[6]=t=>R.throwInputBox("添加单位负责人",L.selectedTask,R.addTaskUserInCharge)),color:"primary",class:"float-right"},{default:(0,i.w5)((()=>[(0,i.Wm)(d.t,null,{default:(0,i.w5)((()=>[(0,i.Uk)("mdi-plus-box")])),_:1})])),_:1}),(0,i._)("table",null,[(0,i._)("tbody",null,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(R.getTask(L.selectedTask).InChargeUsers,(t=>((0,i.wg)(),(0,i.iD)("tr",{key:t.ID},[(0,i._)("td",null,(0,a.zw)(R.getUser(t).DisplayName),1),(0,i._)("td",null,(0,a.zw)(L.techGroup[R.getUser(t).TechGroup[0]].name),1),(0,i._)("td",{onClick:e=>R.deleteTaskUserInCharge(t,L.selectedTask)},[(0,i.Wm)(l.T,null,{default:(0,i.w5)((()=>[(0,i.Wm)(d.t,null,{default:(0,i.w5)((()=>[(0,i.Uk)("mdi-account-multiple-remove-outline")])),_:1})])),_:1})],8,M)])))),128))])])]),J,L.editMode?((0,i.wg)(),(0,i.j4)(Y,{key:0,modelValue:R.getDocument(R.getTask(L.selectedTask).DocumentID).MarkdownBody,"onUpdate:modelValue":e[7]||(e[7]=t=>R.getDocument(R.getTask(L.selectedTask).DocumentID).MarkdownBody=t),onSave:R.editFile,height:"400px"},null,8,["modelValue","onSave"])):((0,i.wg)(),(0,i.j4)(K,{key:1,text:R.getDocument(R.getTask(L.selectedTask).DocumentID).MarkdownBody},null,8,["text"])),L.editMode?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(l.T,{key:2,onClick:e[8]||(e[8]=t=>L.editMode=!0),color:"primary",class:"float-right"},{default:(0,i.w5)((()=>[(0,i.Wm)(d.t,null,{default:(0,i.w5)((()=>[(0,i.Uk)("mdi-file-edit-outline")])),_:1})])),_:1})),L.editMode?((0,i.wg)(),(0,i.j4)(l.T,{key:3,onClick:e[9]||(e[9]=t=>L.editMode=!1),color:"primary",class:"float-right"},{default:(0,i.w5)((()=>[(0,i.Wm)(d.t,null,{default:(0,i.w5)((()=>[(0,i.Uk)("mdi-swap-horizontal")])),_:1})])),_:1})):(0,i.kq)("",!0)],64)):(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("div",p,[w,f,(0,i.Wm)(m.h,{modelValue:L.username,"onUpdate:modelValue":e[2]||(e[2]=t=>L.username=t),label:"用户名",class:"login-box-text-field"},null,8,["modelValue"]),(0,i.Wm)(m.h,{modelValue:L.password,"onUpdate:modelValue":e[3]||(e[3]=t=>L.password=t),label:"密码",type:"password",class:"login-box-text-field"},null,8,["modelValue"]),(0,i.Wm)(l.T,{onClick:e[4]||(e[4]=t=>R.logIn(L.username,L.password)),color:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)("登陆")])),_:1}),k]))])),_:1})])),_:1})])),_:1})}var R=s(680),Z=(s(8556),s(11)),q=s(6572),F=s(1888);const H={class:"list-status"},$={class:"status-quantity"},Y={class:"status-ddl"},K=(0,i._)("strong",null,"DDL",-1),Q={class:"status-remaining-time"};function X(t,e,s,n,r,l){return(0,i.wg)(),(0,i.iD)("ul",H,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(s.task.status,(t=>((0,i.wg)(),(0,i.iD)("li",{key:t.id,class:"status mx-auto my-auto"},[(0,i.Wm)(Z._,null,{default:(0,i.w5)((()=>[(0,i.Wm)(q.E,{class:"yellow"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,a.zw)(t.name),1)])),_:2},1024),(0,i.Wm)(F.Z,null,{default:(0,i.w5)((()=>[(0,i._)("div",$,(0,a.zw)(t.quantity),1),(0,i._)("div",Y,[K,(0,i.Uk)(": "+(0,a.zw)(t.ddl),1)]),(0,i._)("div",Q,"剩余时间："+(0,a.zw)(l.displayRemainTime(l.stringToTime(t.ddl)-Date.now())),1)])),_:2},1024)])),_:2},1024)])))),128))])}var tt=s(4406),et={props:{task:{id:1,name:"英雄",progress:"机械占用",description:"当前算法占用调辅瞄，预期2023-08-16晚结束",comments:[{id:1,user:"张三",message:"弹速今天不稳定:(",time:"2023-08-15 10:10:10"},{id:2,user:"李四",message:"辅瞄不稳",time:"2023-08-15 10:11:10"},{id:3,user:"王五",message:"零飘严重",time:"2023-08-15 10:12:10"}],status:[{id:1,name:"机械",quantity:"云台画图中",ddl:"2023-08-20 10:10:14"},{id:2,name:"嵌软",quantity:"摩擦轮PID调试",ddl:"2023-08-23 20:10:12"},{id:3,name:"电路",quantity:"画图中",ddl:"2023-08-24 03:10:13"},{id:4,name:"算法",quantity:"前哨战测试",ddl:"2023-08-25 15:10:11"}]}},methods:{stringToTime(t){const[e,s]=t.split(" "),[n,i,a]=e.split("-"),[r,l,o]=s.split(":"),u=new Date(n,i-1,a,r,l,o);return u},displayRemainTime(t){const e=(0,tt.Z)(t,"dd天HH小时mm分钟");return e},selectTask(t){this.selectedTask=t,this.currentPage="taskDetail"}}},st=s(89);const nt=(0,st.Z)(et,[["render",X]]);var it=nt,at=s(6281),rt=s(2127),lt=s(9657),ot=s(5030);const ut={key:0};function dt(t,e,s,n,r,u){const g=(0,i.up)("v-list-item-icon"),m=(0,i.up)("v-list-item-content"),p=(0,i.up)("login-status");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i.Wm)(lt.V,{app:"",modelValue:r.drawerOpen,"onUpdate:modelValue":e[1]||(e[1]=t=>r.drawerOpen=t),width:180,class:"sidebar"},{default:(0,i.w5)((()=>[(0,i.Wm)(h.l,{class:"sidebar-header",onClick:e[0]||(e[0]=t=>u.selectTask(0))},{default:(0,i.w5)((()=>[(0,i.Wm)(d.t,null,{default:(0,i.w5)((()=>[(0,i.Uk)("mdi-home")])),_:1}),(0,i.Uk)(" LY manager ")])),_:1}),(0,i.Wm)(o.J),(0,i.Wm)(c.i,{dense:""},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(s.unitGroups,(t=>((0,i.wg)(),(0,i.iD)("div",{key:t.id},[t.id>=1?((0,i.wg)(),(0,i.iD)("div",ut,[(0,i.Wm)(h.l,{onClick:e=>u.selectTask(t.id)},{default:(0,i.w5)((()=>[(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[(0,i.Wm)(d.t,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,a.zw)(t.icon),1)])),_:2},1024)])),_:2},1024),(0,i.Wm)(m,null,{default:(0,i.w5)((()=>[(0,i.Wm)(rt.V,{class:"align-content-center"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,a.zw)(t.name),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])])):(0,i.kq)("",!0)])))),128))])),_:1}),(0,i.Wm)(p,{user:s.currentUser,avatar:s.avatar,loggedIn:s.loggedIn},null,8,["user","avatar","loggedIn"])])),_:1},8,["modelValue"]),(0,i.Wm)(at.L,{app:""},{default:(0,i.w5)((()=>[(0,i.Wm)(l.T,{icon:"",onClick:u.toggleDrawer},{default:(0,i.w5)((()=>[(0,i.Wm)(d.t,null,{default:(0,i.w5)((()=>[(0,i.Uk)("mdi-menu")])),_:1})])),_:1},8,["onClick"]),(0,i.Wm)(ot.q,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,a.zw)(s.title),1)])),_:1})])),_:1})],64)}var ct=s(652),ht=s(8694);const gt={key:0,class:"login-info"},mt={class:"user-details"},pt={key:0},wt={class:"user-name"},ft={key:1},kt={class:"user-name"},Dt={key:1,class:"login-info"},Tt=(0,i._)("div",{class:"user-status"},"Not Logged In",-1);function yt(t,e,n,r,o,u){return(0,i.wg)(),(0,i.iD)("div",{onClick:e[0]||(e[0]=t=>u.loginPage())},[n.loggedIn?((0,i.wg)(),(0,i.iD)("div",gt,[(0,i.Wm)(ct.V,null,{default:(0,i.w5)((()=>[(0,i.Wm)(ht.f,{src:s(1736),alt:"avatar"},null,8,["src"])])),_:1}),(0,i._)("div",mt,[n.user.TechGroup.length>0?((0,i.wg)(),(0,i.iD)("div",pt,[(0,i._)("div",wt,(0,a.zw)(o.techGroups[n.user.TechGroup[0]].name)+" - "+(0,a.zw)(n.user.DisplayName),1)])):((0,i.wg)(),(0,i.iD)("div",ft,[(0,i._)("div",kt,(0,a.zw)(n.user.DisplayName),1)]))])])):((0,i.wg)(),(0,i.iD)("div",Dt,[Tt,(0,i.Wm)(l.T,{color:"primary",onClick:t.login},{default:(0,i.w5)((()=>[(0,i.Uk)("Login")])),_:1},8,["onClick"])]))])}var _t={props:{user:null,avatar:null,loggedIn:null},data(){return{unitGroups:[{name:"未知",id:"0"},{name:"英雄",id:"1"},{name:"工程",id:"2"},{name:"步兵",id:"3"},{name:"哨兵",id:"4"},{name:"无人机",id:"5"},{name:"飞镖",id:"6"},{name:"雷达",id:"7"}],techGroups:[{name:"未知",id:"0"},{name:"机械",id:"1"},{name:"电路",id:"2"},{name:"嵌软",id:"3"},{name:"算法",id:"4"},{name:"管理",id:"5"}]}},methods:{loginPage(){this.$emit("selectTask",-1)}}};const Ut=(0,st.Z)(_t,[["render",yt]]);var vt=Ut,It={data(){return{drawerOpen:!0}},components:{LoginStatus:vt},props:{unitGroups:null,loggedIn:null,avatar:String,currentUser:null,title:null},methods:{selectTask(t){this.$emit("selectTask",t)},toggleDrawer(){this.drawerOpen=!this.drawerOpen}}};const Ct=(0,st.Z)(It,[["render",dt]]);var bt=Ct;const Wt={class:"list-status"},xt={class:"status-quantity"},At={class:"status-ddl"},St=(0,i._)("strong",null,"DDL",-1),Ot={class:"status-remaining-time"},Bt={class:"timeRemainRatio"},Gt={class:"progress"};function Et(t,e,s,n,r,l){return(0,i.wg)(),(0,i.iD)("ul",Wt,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(s.tasks,(n=>((0,i.wg)(),(0,i.iD)("li",{key:n.id,class:"status mx-auto my-auto"},[(0,i.Wm)(Z._,{onClick:e[0]||(e[0]=e=>t.fetchDetail())},{default:(0,i.w5)((()=>[(0,i.Wm)(q.E,{class:"yellow"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,a.zw)(n.name),1)])),_:2},1024),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(n.users,(t=>((0,i.wg)(),(0,i.j4)(h.l,{key:t.id},{default:(0,i.w5)((()=>[(0,i.Wm)(rt.V,{class:"align-content-center"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,a.zw)(s.users[t].name),1)])),_:2},1024)])),_:2},1024)))),128)),(0,i.Wm)(F.Z,null,{default:(0,i.w5)((()=>[(0,i._)("div",xt,(0,a.zw)(n.quantity),1),(0,i._)("div",At,[St,(0,i.Uk)(": "+(0,a.zw)(n.ddl),1)]),(0,i._)("div",Ot,"剩余："+(0,a.zw)(l.displayTime(l.stringToTime(n.ddl)-Date.now())),1),(0,i._)("div",Bt,"距离结束还剩"+(0,a.zw)(((l.stringToTime(n.ddl)-Date.now())/(l.stringToTime(n.ddl)-l.stringToTime(n.st))*100).toFixed(1))+"%的时间",1),(0,i._)("div",Gt,"还有"+(0,a.zw)((100*(1-n.progress)).toFixed(1))+"%的工作未完成",1)])),_:2},1024)])),_:2},1024)])))),128))])}var Nt={props:{users:null,tasks:null},methods:{stringToTime(t){console.log(t);const[e,s]=t.split(" "),[n,i,a]=e.split("-"),[r,l,o]=s.split(":"),u=new Date(n,i-1,a,r,l,o);return u},displayTime(t){if(!(t<0)){const e=Math.floor(t/1e3/60/60/24),s=Math.floor(t/1e3/60/60%24),n=Math.floor(t/1e3/60%60),i=Math.floor(t/1e3%60);return`${e}天${s}小时${n}分钟${i}秒`}},selectTask(t){this.selectedTask=t,this.currentPage="taskDetail"}}};const zt=(0,st.Z)(Nt,[["render",Et]]);var Pt=zt,Vt=s(1334),jt=s(713),Mt=s(9234);const Jt={class:"headline"};function Lt(t,e,s,n,r,o){return(0,i.wg)(),(0,i.j4)(jt.B,{modelValue:r.dialogVisible,"onUpdate:modelValue":e[1]||(e[1]=t=>r.dialogVisible=t),"max-width":"500px"},{default:(0,i.w5)((()=>[(0,i.Wm)(Z._,null,{default:(0,i.w5)((()=>[(0,i.Wm)(q.E,null,{default:(0,i.w5)((()=>[(0,i._)("span",Jt,(0,a.zw)(s.message),1)])),_:1}),(0,i.Wm)(F.Z,null,{default:(0,i.w5)((()=>[(0,i.Wm)(m.h,{modelValue:r.userInput,"onUpdate:modelValue":e[0]||(e[0]=t=>r.userInput=t),label:"输入",required:""},null,8,["modelValue"])])),_:1}),(0,i.Wm)(Vt.h,null,{default:(0,i.w5)((()=>[(0,i.Wm)(Mt.C),(0,i.Wm)(l.T,{color:"primary",onClick:o.closeDialog},{default:(0,i.w5)((()=>[(0,i.Uk)("取消")])),_:1},8,["onClick"]),(0,i.Wm)(l.T,{color:"primary",onClick:o.submitUserInput},{default:(0,i.w5)((()=>[(0,i.Uk)("确认")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"])}var Rt={props:{value:Boolean,message:null},data(){return{dialogVisible:this.value,userInput:""}},watch:{value(t){this.dialogVisible=t}},methods:{closeDialog(){this.dialogVisible=!1,this.userInput="",this.$emit("user-input",null)},submitUserInput(){""!==this.userInput.trim()&&(console.log("用户输入:",this.userInput),this.$emit("user-input",this.userInput))}}};const Zt=(0,st.Z)(Rt,[["render",Lt]]);var qt=Zt;function Ft(t,e,s,n,r,o){return(0,i.wg)(),(0,i.j4)(jt.B,{modelValue:r.internalShowDialog,"onUpdate:modelValue":e[0]||(e[0]=t=>r.internalShowDialog=t),"max-width":"400"},{default:(0,i.w5)((()=>[(0,i.Wm)(Z._,null,{default:(0,i.w5)((()=>[(0,i.Wm)(q.E,{class:"headline"},{default:(0,i.w5)((()=>[(0,i.Uk)("提示")])),_:1}),(0,i.Wm)(F.Z,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,a.zw)(s.message),1)])),_:1}),(0,i.Wm)(Vt.h,null,{default:(0,i.w5)((()=>[(0,i.Wm)(l.T,{color:"primary",text:"",onClick:o.closeDialog},{default:(0,i.w5)((()=>[(0,i.Uk)("关闭")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"])}var Ht={props:{message:String,showDialog:Boolean},data(){return{internalShowDialog:this.showDialog}},methods:{closeDialog(){this.internalShowDialog=!1,this.$emit("update:showDialog",!1)}},watch:{showDialog(t){this.internalShowDialog=t}}};const $t=(0,st.Z)(Ht,[["render",Ft]]);var Yt=$t,Kt=s(220),Qt={computed:{task(){return Kt.task}},components:{SidebarDisplay:bt,StatusDisplay:it,TaskDisplay:Pt,AlertBox:Yt,InputBox:qt},data(){return{userToken:R.Z.get("user_token")||"",currentTitle:null,userInputSubmitted:null,connected:!0,loggedIn:!1,showDialog:!1,showInputBox:!1,alertMessage:null,dialogVisible:!1,userInput:"",currentUnitGroup:null,currentEdit:{father:null,son:null},unitGroup:[{name:"未知",id:0},{name:"英雄",id:1,unitsList:[]},{name:"工程",id:2},{name:"步兵",id:3},{name:"哨兵",id:4},{name:"无人机",id:5},{name:"飞镖",id:6},{name:"雷达",id:7}],techGroup:[{name:"未知",id:0},{name:"机械",id:1},{name:"电路",id:2},{name:"嵌软",id:3},{name:"算法",id:4},{name:"管理",id:5}],users:[],tasks:[],units:[],documents:[],currentDocumentID:null,editMode:null,username:null,password:null,currentUser:{Name:"root",DisplayName:"系统",TechGroup:[1],UnitGroup:[1],Authority:"System",Token:"token"},avatar:"../assets/img/34596177.jpg",name:"",currentPage:"TaskDetail",currentTasksList:[],selectedUnitGroup:null,selectedTask:null,newComment:"",socket:null}},methods:{stringToTime(t){console.log(t);const[e,s]=t.split(" "),[n,i,a]=e.split("-"),[r,l,o]=s.split(":"),u=new Date(n,i-1,a,r,l,o);return u},displayTime(t){if(!(t<0)){const e=Math.floor(t/1e3/60/60/24),s=Math.floor(t/1e3/60/60%24),n=Math.floor(t/1e3/60%60),i=Math.floor(t/1e3%60);return`${e}天${s}小时${n}分钟${i}秒`}},async sendAndReceiveData(t){return new Promise((e=>{this.socket.send(t),this.socket.addEventListener("message",(t=>{const s=t.data;console.log("Received message:",s),e(s)}))}))},async sendData(t){this.socket.send(t)},throwAlert(t){this.showDialog=!0,this.alertMessage=t},async addTask(t){const e=await this.sendAndReceiveData('+task {"BindUnitID":'+t+"}");await this.fetchTask([e]),this.getUnit(t).InProgressTasks.push(e)},async addUnitUserInCharge(t){if(null===t)return void(this.showInputBox=!1);const e=await this.sendAndReceiveData("!query user user_display_name "+t),s=JSON.parse(e);if("-"===e.charAt(0))this.throwAlert("用户不存在");else{if(this.getUnit(this.currentEdit).InChargeUsers.includes(s))return this.throwAlert("负责人已存在"),void(this.showInputBox=!1);this.getUnit(this.currentEdit).InChargeUsers.push(s),console.log("++++++"+this.getUnit(this.currentEdit).InChargeUsers),await this.sendData("!update unit "+this.currentEdit+" "+JSON.stringify(this.getUnit(this.currentEdit))),console.log("------"+this.getUnit(this.currentEdit).InChargeUsers)}this.showInputBox=!1},deleteUnitUserInCharge(t,e){this.getUnit(e).InChargeUsers.splice(this.getUnit(e).InChargeUsers.indexOf(t),1),this.sendData("!update unit "+e+" "+JSON.stringify(this.getUnit(e)))},async addTaskUserInCharge(t){if(null===t)return void(this.showInputBox=!1);const e=await this.sendAndReceiveData("!query user user_display_name "+t),s=JSON.parse(e);if("-"===e.charAt(0))this.throwAlert("用户不存在");else{if(this.getTask(this.currentEdit).InChargeUsers.includes(s))return this.throwAlert("负责人已存在"),void(this.showInputBox=!1);await this.fetchUser([s]),this.getTask(this.currentEdit).InChargeUsers.push(s),await this.sendData("!update task "+this.currentEdit+" "+JSON.stringify(this.getTask(this.currentEdit)))}this.showInputBox=!1},deleteTaskUserInCharge(t,e){this.getTask(e).InChargeUsers.splice(this.getTask(e).InChargeUsers.indexOf(t),1),this.sendData("!update task "+e+" "+JSON.stringify(this.getTask(e)))},editFile(t){this.editMode=!0,this.getDocument(this.getTask(this.selectedTask).DocumentID).MarkdownBody=t;try{this.sendData("!update document "+this.getTask(this.selectedTask).DocumentID+" "+JSON.stringify(this.getDocument(this.getTask(this.selectedTask).DocumentID))),this.throwAlert("保存成功")}catch(e){this.throwAlert("服务器未响应")}},throwInputBox(t,e,s){this.showInputBox=!0,this.alertMessage=t,this.currentEdit=e,this.userInputSubmitted=s},async updateTaskProgress(t){if(null===t)return void(this.showInputBox=!1);this.currentEdit.Progress=t;const e=await this.sendAndReceiveData("!update task "+this.currentEdit.ID+" "+JSON.stringify(this.currentEdit));"-"===e.charAt(0)?this.throwAlert("无权限，请联系管理员"):this.throwAlert("更新成功"),this.showInputBox=!1},updateTaskDescription(t){null!==t?(this.currentEdit.Description=t,this.sendData("!update task "+this.currentEdit.ID+" "+JSON.stringify(this.currentEdit)),this.showInputBox=!1):this.showInputBox=!1},updateTaskName(t){null!==t?(this.currentEdit.Name=t,this.sendData("!update task "+this.currentEdit.ID+" "+JSON.stringify(this.currentEdit)),this.showInputBox=!1):this.showInputBox=!1},updateTaskDeadLine(t){null!==t?(this.currentEdit.DeadLine=t,this.sendData("!update task "+this.currentEdit.ID+" "+JSON.stringify(this.currentEdit)),this.showInputBox=!1):this.showInputBox=!1},updateTaskStartTime(t){null!==t?(this.currentEdit.StartTime=t,this.sendData("!update task "+this.currentEdit.ID+" "+JSON.stringify(this.currentEdit)),this.showInputBox=!1):this.showInputBox=!1},getUser(t){return null===t?{ID:0,DisplayName:"加载中",InChargeUsers:[],CurrentUserID:-1,InProgressTasks:[]}:(console.log(this.users),this.users.find((e=>e.ID===t)))},async fetchUser(t){for(let s of t){if(-1===s)continue;console.log("Fetch user "+s+".");const t=this.users.find((t=>t.ID===s));if(!t)try{const t=await this.sendAndReceiveData("?user id "+s);if("-"===t.charAt(0))return console.log("获取用户详情失败"),this.throwAlert("获取用户详情失败"),null;try{const e=JSON.parse(t);e.ID=s,this.users.push(e)}catch(e){this.throwAlert("Json解析错误")}}catch(e){this.throwAlert("用户不存在")}}},getTask(t){return null===t?{ID:0,DisplayName:"加载中",InChargeUsers:[],CurrentUserID:-1,InProgressTasks:[]}:(console.log("Get task "+t+"."),this.tasks.find((e=>e.ID===t)))},async fetchTask(t){for(let s of t){if(-1===s)continue;console.log("Fetch task "+s+".");const t=this.users.find((t=>t.id===s));if(!t)try{const t=await this.sendAndReceiveData("?task id "+s);if("-"===t.charAt(0))return console.log("获取任务详情失败"),this.throwAlert("获取任务详情失败"),null;try{const e=JSON.parse(t);await this.fetchUser(e.InChargeUsers),await this.fetchDocument([e.DocumentID]),e.ID=s,this.tasks.push(e)}catch(e){this.throwAlert("Json解析错误")}}catch(e){this.throwAlert("任务不存在")}}},getUnit(t){return void 0===t?{ID:0,DisplayName:"加载中",InChargeUsers:[],CurrentUserID:-1,InProgressTasks:[]}:-1===t?(this.throwAlert("单位查询错误，请联系管理员"),null):(console.log("Get unit "+t+"."),this.units.find((e=>e.ID===t)))},async fetchUnit(t){for(let s of t){if(-1===s)continue;console.log("Fetch unit "+s+".");const t=this.units.find((t=>t.id===s));if(!t)try{const t=await this.sendAndReceiveData("?unit id "+s);if("-"===t.charAt(0))return console.log("获取单位详情失败"),this.throwAlert("获取单位详情失败"),null;try{const e=JSON.parse(t);e.ID=s,await this.fetchUser(e.InChargeUsers),await this.fetchUser([e.CurrentUserID]),await this.fetchTask(e.InProgressTasks),this.units.push(e)}catch(e){this.throwAlert("Json解析错误")}}catch(e){this.throwAlert("单位不存在")}}},getDocument(t){return console.log("Get document "+t+"."),this.documents.find((e=>e.ID===t))},async fetchDocument(t){for(let s of t){if(-1===s)continue;console.log("Fetch document "+s+".");const t=this.documents.find((t=>t.id===s));if(!t)try{const t=await this.sendAndReceiveData("?document id "+s);if("-"===t.charAt(0))return console.log("获取文档详情失败"),this.throwAlert("获取文档详情失败"),null;try{const e=JSON.parse(t);e.ID=s,this.documents.push(e)}catch(e){this.throwAlert("Json解析错误")}}catch(e){this.throwAlert("文档不存在")}}},async selectUnitGroup(t){if(console.log("Select unit group "+t+"."),0===t)this.currentPage="UnitGroups";else if(-1===t)this.loggedIn=!1;else{this.selectedUnitGroup=t,this.currentUnitGroup=this.unitGroup.find((e=>e.id===t)),this.currentTitle=this.currentUnitGroup.name+"组";try{const e=await this.sendAndReceiveData("?unit unit_group "+t);this.currentUnitGroup.unitsList=JSON.parse(e),await this.fetchUnit(this.currentUnitGroup.unitsList),console.log("Received response data:",e)}catch(e){console.error("Error:",e)}this.currentPage="UnitGroupDetail"}},selectTask(t){this.currentPage="TaskDetail",this.selectedTask=t,this.currentDocumentID=this.getTask(t).DocumentID},async logIn(t,e){console.log("Try login.");try{const n=await this.sendAndReceiveData("!login "+t+" "+e);if("-1"===n)this.throwAlert("未找到用户");else if("-2"===n)this.throwAlert("用户名或密码错误");else{try{this.currentUser=JSON.parse(n);const t=this.currentUser.Token,e=this.currentUser.Name;R.Z.set("user_name",e,{path:"/"}),R.Z.set("token",t,{path:"/"}),this.loggedIn=!0,console.log("Login success.")}catch(s){this.throwAlert("Json解析错误")}this.currentPage="UnitGroups",await this.selectUnitGroup(1)}}catch(s){this.throwAlert("服务器未响应")}},async autoLogIn(){const t=R.Z.get("token"),e=R.Z.get("user_name");if(console.log("Try auto login "+e+" "+t+"."),"-"===t)return;const s=await this.sendAndReceiveData("!login "+e+" "+t);if("-"===s.charAt(0))this.throwAlert("自动登录失败"),R.Z.set("user_name","-",{path:"/"}),R.Z.set("token","-",{path:"/"});else{try{this.currentUser=JSON.parse(s);const t=this.currentUser.Token,e=this.currentUser.Name;R.Z.set("user_name",e,{path:"/"}),R.Z.set("token",t,{path:"/"}),this.loggedIn=!0,console.log("Login success.")}catch(n){this.throwAlert("Json解析错误")}this.currentPage="UnitGroups",await this.selectUnitGroup(1)}}},testConnection(){const t=new WebSocket("ws://127.0.0.1:6363");t.addEventListener("open",(()=>{console.log("Connected to server."),t.send("!login root    "),t.send("?unit id 0")})),t.addEventListener("message",(t=>{console.log("Received message:",t.data)})),t.addEventListener("close",(t=>{console.log("Connection closed:",t.reason)}))},async created(){this.socket=new WebSocket("ws://182.92.120.146:8989"),this.socket.onerror=function(){console.log("连接失败"),this.connected=!1},this.socket.onopen=this.autoLogIn,this.editMode=!1}};const Xt=(0,st.Z)(Qt,[["render",L]]);var te=Xt,ee=(s(9773),s(8727)),se=(0,ee.Rd)();async function ne(){const t=await s.e(461).then(s.t.bind(s,3657,23));t.load({google:{families:["Roboto:100,300,400,500,700,900&display=swap"]}})}var ie=s(7709),ae=s.n(ie),re=s(164),le=s.n(re),oe=s(2549),ue=s.n(oe),de=(s(9525),s(1973),s(1739),s(9498)),ce=s.n(de);ce().use(le(),{Prism:ue()}),ae().use(le(),{Prism:ue()}),ne(),(0,n.ri)(te).use(ce()).use(se).use(ae()).mount("#app")},1736:function(t,e,s){t.exports=s.p+"img/34596177.05a1478a.jpg"}},e={};function s(n){var i=e[n];if(void 0!==i)return i.exports;var a=e[n]={exports:{}};return t[n].call(a.exports,a,a.exports,s),a.exports}s.m=t,function(){var t=[];s.O=function(e,n,i,a){if(!n){var r=1/0;for(d=0;d<t.length;d++){n=t[d][0],i=t[d][1],a=t[d][2];for(var l=!0,o=0;o<n.length;o++)(!1&a||r>=a)&&Object.keys(s.O).every((function(t){return s.O[t](n[o])}))?n.splice(o--,1):(l=!1,a<r&&(r=a));if(l){t.splice(d--,1);var u=i();void 0!==u&&(e=u)}}return e}a=a||0;for(var d=t.length;d>0&&t[d-1][2]>a;d--)t[d]=t[d-1];t[d]=[n,i,a]}}(),function(){s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,{a:e}),e}}(),function(){var t,e=Object.getPrototypeOf?function(t){return Object.getPrototypeOf(t)}:function(t){return t.__proto__};s.t=function(n,i){if(1&i&&(n=this(n)),8&i)return n;if("object"===typeof n&&n){if(4&i&&n.__esModule)return n;if(16&i&&"function"===typeof n.then)return n}var a=Object.create(null);s.r(a);var r={};t=t||[null,e({}),e([]),e(e)];for(var l=2&i&&n;"object"==typeof l&&!~t.indexOf(l);l=e(l))Object.getOwnPropertyNames(l).forEach((function(t){r[t]=function(){return n[t]}}));return r["default"]=function(){return n},s.d(a,r),a}}(),function(){s.d=function(t,e){for(var n in e)s.o(e,n)&&!s.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})}}(),function(){s.f={},s.e=function(t){return Promise.all(Object.keys(s.f).reduce((function(e,n){return s.f[n](t,e),e}),[]))}}(),function(){s.u=function(t){return"js/webfontloader.330b2b6b.js"}}(),function(){s.miniCssF=function(t){}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={},e="lymanager:";s.l=function(n,i,a,r){if(t[n])t[n].push(i);else{var l,o;if(void 0!==a)for(var u=document.getElementsByTagName("script"),d=0;d<u.length;d++){var c=u[d];if(c.getAttribute("src")==n||c.getAttribute("data-webpack")==e+a){l=c;break}}l||(o=!0,l=document.createElement("script"),l.charset="utf-8",l.timeout=120,s.nc&&l.setAttribute("nonce",s.nc),l.setAttribute("data-webpack",e+a),l.src=n),t[n]=[i];var h=function(e,s){l.onerror=l.onload=null,clearTimeout(g);var i=t[n];if(delete t[n],l.parentNode&&l.parentNode.removeChild(l),i&&i.forEach((function(t){return t(s)})),e)return e(s)},g=setTimeout(h.bind(null,void 0,{type:"timeout",target:l}),12e4);l.onerror=h.bind(null,l.onerror),l.onload=h.bind(null,l.onload),o&&document.head.appendChild(l)}}}(),function(){s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){s.p=""}(),function(){var t={143:0};s.f.j=function(e,n){var i=s.o(t,e)?t[e]:void 0;if(0!==i)if(i)n.push(i[2]);else{var a=new Promise((function(s,n){i=t[e]=[s,n]}));n.push(i[2]=a);var r=s.p+s.u(e),l=new Error,o=function(n){if(s.o(t,e)&&(i=t[e],0!==i&&(t[e]=void 0),i)){var a=n&&("load"===n.type?"missing":n.type),r=n&&n.target&&n.target.src;l.message="Loading chunk "+e+" failed.\n("+a+": "+r+")",l.name="ChunkLoadError",l.type=a,l.request=r,i[1](l)}};s.l(r,o,"chunk-"+e,e)}},s.O.j=function(e){return 0===t[e]};var e=function(e,n){var i,a,r=n[0],l=n[1],o=n[2],u=0;if(r.some((function(e){return 0!==t[e]}))){for(i in l)s.o(l,i)&&(s.m[i]=l[i]);if(o)var d=o(s)}for(e&&e(n);u<r.length;u++)a=r[u],s.o(t,a)&&t[a]&&t[a][0](),t[a]=0;return s.O(d)},n=self["webpackChunklymanager"]=self["webpackChunklymanager"]||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))}();var n=s.O(void 0,[998],(function(){return s(1751)}));n=s.O(n)})();
//# sourceMappingURL=app.cd0ba0f0.js.map